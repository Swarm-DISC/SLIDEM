/*

    SLIDEM Processor: calion.c

    Copyright (C) 2022  Johnathan K Burchill

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <https://www.gnu.org/licenses/>.
*/

// Based on IRI-2016 functions. See IRI2016-License.txt.
// Adapted from initial transription from fortran to C using f2c 
// from http://www.netlib.org/f2c/index.html
// "A Fortran to C Converter", S. I. Feldman, ACM SIGPLAN Fortran Forum, vol. 9, issue 2, p. 21–22 (1990).

#include "calion.h"

#include "iri2016util.h"

#include <stdio.h>

#include <gsl/gsl_math.h>
#include <gsl/gsl_sf_exp.h>
#include <math.h>

void calion(double diplatitude, double invlatitude, double mlt, double alt, int ddd, double pf107obs, double ionRelativeDensities[4])
{
	// From IRISUB.for
	// c Correcting F10.7 adjusted flux from APF107.DAT to flux observed at
	// c Earth that is expected by NRLMSIS00 (GTD7) and CHEMION AND TBT-2015
	// C (ION COMPOSITION) AND TBT-2012 (ELECTRON TEMPERATURE)          

	// Notes from IRIFUN.for
/* ---------------------------------------------------------------------- */
/* Version 2.5 (released 6.4.2016) (Includes a correction for PF107<87.5 */
/* based on C/NOFS CINDI data) */
/* CALION calculates ion density of O+, H+, He+ and N+  in the outer */
/* ionosphere with regard to solar activity (F107 index). */
/* CALION uses subroutines IONLOW and IONHIGH. */
/* Linearly interpolates the logarithmic ion densities in solar activity. */
/* Inputs: invlat - invariant latitude, equiv to inv dip lat at inv latitues poleward of 40 degrees; */
/*                    positive northward, in deg, range <-90.0;90.0> */
/*         MLT - magnetic local time (central dipole) */
/*               in hours, range <0;24) */
/*         ALT - altitude above the Earth's surface; */
/*               in km, range <350;2000> */
/*         DDD - day of year; range <0;365> */
/*         PF107 - PF107 index */
/* Output: NO,NH,NHE,NN - relative density of O+, H+, He+, and N+ in % */
/* Versions:  2.5 FORTRAN */

/* REFERENCES: */
/*   Triskova, L., Truhlik, V., Smilauer, J. An empirical model of ion */
/*      composition in the outer ionosphere. Adv. Space Res. 31 (3), */
/*      653–663, 2003. */
/*   Truhlik, V., Triskova, L., Smilauer, J. New advances in empirical */
/*      modeling of ion composition in the outer ionosphere. Adv. Space */
/*      Res. 33, 844–849, 2004. */
/*   Truhlik V., D. Bilitza, L. Triskova, Towards better description of */
/*     solar activity variation in the International Reference Ionosphere */
/*     topside ion composition model, Advances in Space Research, */
/*     Volume 55, Issue 8, 15 April 2015, Pages 2099-2105, ISSN 0273-1177, */
/*     http://dx.doi.org/10.1016/j.asr.2014.07.033. */


	double no, nh, nhe, nn;

	double corro[3] = { 1.872, 1.64, 1.234 };
    double corrh[3] = { 0.762, 0.836, 1.033 };

    double dol[4][3][49] = {11.028, -5.9947e-7, -0.33742, 7.8683e-7, 0.13937, 8.3175e-8, -0.04864, -0.24412, 3.1765e-7, -0.030586, -3.2124e-8, -0.020091, 9.5865e-8, -0.24533, -3.1051e-7, -0.013402, 1.5715e-7, -0.035108, -7.0552e-9, 0.072451, -5.4795e-8, 0.0046388, 2.6538e-8, -0.0017863, -0.032795, 2.1667e-7, -0.0016886, -1.1351e-7, 0.00048819, -0.018702, 1.5855e-8, 0.0024774, -6.0513e-11, 0.026071, -1.5258e-8, 0.0054362, 2.6064e-8, -0.0058978, -5.6781e-9, 0.0017888, 0.0079854, 4.3021e-8, 0.00075171, -0.0034351, 2.3671e-8, 0.0018393, 4.3624e-11, -0.003162, 0.0022396, 10.935, 0.43766, -0.31289, -0.13726, 0.13358, 0.043905, 0.05016, -0.25849, 0.045659, 0.0054857, 0.022218, -0.028317, 0.008263, -0.28326, -0.0096791, 0.041894, 0.0077419, -0.019546, -0.010279, 0.039292, -0.015802, 0.0094275, -0.00081618, 0.0018252, -0.044936, -0.0095925, 0.01029, -0.0043728, 0.0026103, 0.017584, -0.0001557, -0.0050717, 0.00022696, 0.007704, 0.0037456, -0.0017878, 0.00080229, -0.014827, 0.0061296, -0.00122, 0.0016822, 0.0062744, -0.0021599, -0.022537, 0.0033963, -0.008423, 0.0028959, -0.017315, -0.0047823, 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 10.441, -1.8583e-7, -0.15392, 1.3279e-6, -0.02891, 4.6595e-8, -0.040713, -0.4828, -4.4062e-7, 0.0088233, 1.5207e-7, -0.026193, -5.6026e-8, -0.25563, 3.7636e-7, -0.05364, -2.5118e-7, -0.039499, 5.6905e-8, 0.063005, -1.0823e-7, -0.0046264, 1.3677e-8, 0.0057388, -0.026456, 2.198e-7, -0.0063113, -9.6352e-8, 0.0063825, 0.021161, -1.1267e-7, -0.0033647, 1.6196e-8, 0.0268, 1.7619e-7, 0.0095012, -4.3477e-9, 0.019645, 6.8076e-9, 0.00083642, 0.020048, -2.6173e-8, 0.0028416, 0.0012859, 2.4308e-8, -0.0031225, -7.8282e-9, -0.0042809, 0.0064016, 10.428, 0.50284, -0.10415, -0.23068, 0.099921, 0.024525, 0.10017, -0.43949, 0.077712, 0.02767, 0.009804, -0.04089, 0.011955, -0.23115, -0.0178, 0.029761, 0.0032814, -0.010608, -0.011838, 0.046797, -0.025308, -0.0021772, -0.00062791, 0.00039284, -0.095448, -0.0075227, 0.004704, 0.0055001, 0.001142, 0.059417, -0.010356, -0.011835, 0.0049372, -0.016572, 0.0077212, 0.0025303, -0.0021244, 0.0018799, 0.0075457, -0.0039116, 0.0029587, 0.0010549, -0.00016082, -0.022565, -0.00038407, -0.0064016, 0.0019367, -0.024715, -0.0043424, 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 9.7046, -1.9504e-6, 0.16453, 4.1395e-6, -0.028124, -5.0045e-6, 0.16867, -0.9493, -1.9466e-6, 0.0007276, 4.5795e-7, -0.04039, 3.8333e-9, -0.41313, 7.3783e-7, -0.090851, 8.4989e-7, -0.009422, -8.8451e-7, 0.088378, -2.2731e-7, -0.0013118, -2.4401e-7, 0.0067618, -0.075769, 3.1554e-7, -0.0094427, -3.2472e-8, -0.00082261, 0.1212, 9.909e-8, -0.0094052, 7.1322e-8, 0.097052, 1.2635e-7, 0.012328, -6.2071e-8, 0.023364, 2.873e-9, -0.0040942, 0.044158, -8.1883e-8, 0.00096001, 0.0034871, -8.468e-8, -0.0029931, -8.06e-8, 0.00035474, 0.0059745, 9.7665, 0.70796, 0.097141, -0.34388, 0.15406, -0.099645, 0.086633, -0.66761, 0.19789, 0.012181, 0.019043, -0.014917, -0.013319, -0.24644, 0.019972, 0.0070064, 0.020894, -0.0049076, -0.018647, 0.027701, -0.0075134, -0.0010716, -0.003523, 0.0031439, -0.1986, 0.019707, 0.0033487, 0.020649, 0.0002956, 0.094027, -0.033459, 0.0032062, 0.0022061, -0.044366, 0.0088768, 0.0036112, 0.00060056, -0.0092459, -0.0046701, 0.0019506, -0.001488, -0.0096133, 0.0022348, -0.032551, -0.0051712, -0.028312, -0.00015611, -0.039494, -0.013699, 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 9.1361, -9.743e-7, 0.16267, 4.3277e-6, 0.1154, -3.0602e-6, 0.058135, -1.127, -6.2546e-7, -0.048728, 1.7487e-6, -0.021179, -4.7905e-7, -0.40648, 1.3901e-6, -0.12238, -4.254e-7, -0.039834, 1.7409e-7, -0.038208, -1.008e-6, 0.0034987, 5.4186e-7, -0.00080568, -0.054931, 8.2682e-7, 0.021062, 2.2819e-7, -0.0086679, 0.072199, 5.2536e-8, -0.0050089, -2.0015e-8, 0.087559, 3.1601e-7, 0.0085504, 1.1819e-7, -0.0030228, 8.0826e-8, -0.0028599, 0.026641, 2.1867e-7, -0.0029991, -0.0018339, 4.6824e-8, -0.0017178, 1.4137e-7, 0.0022711, -0.0003699, 9.2203, 0.62242, 0.37901, -0.37432, 0.23634, -0.20471, 0.033947, -0.78196, 0.072937, -0.00402, 0.014082, 0.026208, -0.027142, -0.29473, -0.020525, 0.092248, 0.0079193, 0.044462, -0.044945, -0.029301, -0.071699, -0.0058144, -0.0046876, -0.005468, -0.21563, 0.028593, 0.0096277, 0.019712, 0.013128, 0.072789, -0.010102, 0.0010531, -0.0059706, 0.017574, -0.0036999, -0.00029097, 0.005309, -0.012282, -0.0004871, 0.00064886, 0.0084747, 0.000088815, -0.0036183, -0.014276, -0.0053265, -0.022889, 0.0030205, -0.011674, -0.0049931, 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.};

    double dnl[4][3][49] = {9.2765, -1.8499e-7, -0.030195, -2.363e-7, 0.012337, -5.3134e-7, 0.010174, -0.30143, -4.4969e-7, 0.040224, 2.5418e-7, -0.022113, -9.3834e-8, -0.26967, -2.2087e-7, -0.03067, 1.8923e-7, -0.017787, -7.4715e-8, 0.058658, 1.0175e-7, -0.0049642, 8.0931e-9, -0.00058069, -0.0096466, -1.9936e-7, 0.000085438, 9.6678e-8, -0.0014405, -0.0081367, 1.2139e-7, -0.00064643, -2.8006e-9, 0.021228, -8.6142e-8, 0.0062702, 3.6155e-8, 0.0082411, 4.7083e-8, 0.00038409, 0.012262, -1.7636e-8, 0.0015587, 0.0019816, -3.3066e-8, -0.0027297, -1.8297e-8, 0.00012335, 0.0011364, 9.2392, 0.40188, 0.06393, -0.085958, -0.0047951, -0.024724, -0.032147, -0.35425, 0.0091141, 0.054439, 0.02132, -0.02729, -0.0032257, -0.32031, -0.0047704, 0.041115, -0.0036383, -0.016398, -0.0024104, 0.00082126, -0.011835, 0.0059562, 0.001701, 0.00050395, -0.093262, -0.011371, 0.015332, -0.0020002, -0.00028968, 0.039653, -0.0052539, -0.0052158, -0.00032324, 0.0043222, -0.0053072, 0.00063232, 0.00069118, -0.0060341, -0.00062083, -0.0013747, -0.000042513, -0.0043487, -0.00020489, -0.016498, -0.0034412, -0.012307, -0.0030081, -0.014694, -0.0090169, 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 9.0063, 8.5692e-7, 0.13438, 7.5368e-7, -0.10519, -5.5276e-6, 0.099278, -0.30846, 4.0235e-7, 0.063959, 9.1603e-7, -0.027028, -6.3298e-7, -0.38941, 6.3463e-7, -0.083377, 5.6084e-7, -0.020251, -5.4261e-7, 0.089982, -9.5019e-8, -0.0052807, 4.6354e-8, 0.0029355, -0.0046802, 9.8816e-8, -0.0027926, 2.2151e-7, 0.0013646, 0.027718, -3.4461e-9, -0.0055476, -2.4872e-8, 0.034413, -8.8181e-8, 0.0093552, 1.3853e-8, 0.022646, 2.8251e-8, -0.0015192, 0.013859, 1.6226e-8, 0.0036852, 0.0024081, 3.964e-8, -0.0090767, 7.0011e-8, -0.0015147, 0.00078946, 8.9712, 0.62259, 0.25911, -0.29261, 0.11094, -0.22072, -0.063167, -0.37597, 0.11875, 0.00063175, 0.0091767, -0.012431, -0.010901, -0.27977, -0.013503, -0.011409, 0.026856, 0.0090748, -0.030204, 0.053404, -0.023036, 0.00031147, 0.0055788, -0.0054323, -0.09733, -0.023986, 0.0043029, 0.020047, -0.003734, 0.023783, -0.015343, -0.0028604, 0.0027675, -0.015551, -0.0071283, 0.00053254, 0.0015451, -0.015329, 0.00081201, -0.0020467, -0.013033, -0.0054349, 0.001355, -0.027607, -0.0054011, -0.016276, -0.0016858, -0.035652, -0.013964, 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 8.5862, -3.2389e-7, 0.25327, -5.5733e-6, -0.10952, 1.3457e-6, 0.15412, -0.51416, 2.0209e-6, -0.011427, -9.9065e-7, -0.030871, -1.4579e-7, -0.35447, -1.8618e-6, -0.12044, 2.7905e-7, -0.018735, -6.8531e-7, 0.089785, 1.2276e-6, -0.0078418, 1.35e-8, 0.0047094, 0.093388, 1.3278e-8, -0.008388, 4.8633e-7, -0.0059264, 0.042086, 9.9745e-8, -0.01253, -1.5369e-7, 0.10372, -1.7825e-8, 0.011288, 2.385e-7, 0.0081607, -1.146e-9, -0.0028998, 0.015298, -1.7277e-8, 0.0015876, 0.0045693, 8.3482e-8, -0.0058085, 1.1993e-7, -0.00048027, -0.00002811, 8.686, 0.62474, 0.39864, -0.35056, 0.067989, -0.20349, -0.043468, -0.28985, 0.069687, 0.038408, -0.039263, 0.024613, -0.016681, -0.20418, -0.049327, -0.017733, 0.063639, -0.0019788, -0.040926, 0.042652, -0.020606, 0.01235, -0.024292, 0.016044, -0.089173, -0.02033, 0.020639, 0.0068728, 0.0025223, 0.031266, -0.014652, 0.0055005, -0.0050159, -0.00027642, 0.0020299, 0.0036913, -0.0017547, -0.016781, -0.014129, 0.0070872, -0.010006, -0.0028588, -0.00063962, -0.036016, -0.0070462, -0.020823, -0.0012145, -0.036628, -0.017476, 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 8.2783, -1.3145e-6, 0.16634, -4.4507e-7, -0.0093753, 2.7889e-6, -0.011895, -0.49691, -8.0933e-7, -0.050906, -9.0499e-7, -0.0065566, 5.0452e-7, -0.32368, 4.0711e-7, -0.11566, 2.2821e-8, -0.046834, -1.987e-8, 0.089269, 5.2219e-7, 0.009249, -3.0279e-7, -0.0024639, 0.12319, 3.4657e-7, 0.0098288, -2.0789e-8, -0.0030805, 0.012434, 2.7959e-7, -0.0053884, -4.8629e-8, 0.086375, -1.408e-7, 0.010559, 5.5476e-8, -0.00058048, 3.2727e-8, -0.00099461, -0.0056637, 1.7444e-7, -0.0030875, 0.004438, -2.7864e-8, -0.0030832, 2.9972e-8, -0.0019701, -0.0075436, 8.3694, 0.59656, 0.44055, -0.23417, -0.11354, 0.017281, -0.053018, -0.32389, 0.0046938, 0.0084262, -0.0083879, 0.0077294, 0.0046891, -0.22034, -0.034145, 0.062052, 0.048528, -0.0052128, -0.024769, 0.014277, -0.030019, -0.015376, -0.0068305, -0.0017002, -0.040215, 0.016609, 0.023233, 0.0054203, 0.0014267, 0.055382, -0.017332, -0.0027946, -0.001389, 0.037206, -0.0041274, 0.0042794, 0.0002775, -0.0070599, -0.00010803, 0.0013258, -0.012112, 0.00073725, 0.00063315, -0.0122, -0.0054789, -0.016331, -0.0015537, -0.0059603, -0.0039097, 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.};

    double dhel[4][3][49] = {8.047, -1.2106e-6, -0.18765, -4.5251e-7, -0.18951, -1.9758e-7, 0.1399, -0.073152, -7.752e-7, -0.018854, 3.0364e-7, -0.033138, -3.4716e-7, 0.41146, -2.3661e-7, 0.039635, -3.3287e-9, 0.0029161, -6.2e-8, 0.031584, -1.7889e-7, -0.011569, 2.1482e-8, 0.0032708, 0.031773, 2.0077e-8, -0.012848, -8.0711e-8, -0.013686, -0.018028, -8.6107e-8, -0.0086541, 1.6977e-8, 0.021756, -1.0723e-7, 0.0054701, -9.9269e-9, 0.019697, 3.8353e-8, -0.00031468, -0.008277, -3.4043e-8, -0.0027124, 0.002936, 8.8432e-9, 0.0019854, -3.0817e-9, 0.0016478, 0.0022964, 7.7686, -0.70994, -0.02921, 0.0042677, -0.0028787, 0.024734, -0.042253, 0.0016763, -0.02282, 0.019391, 0.017941, 0.023819, -0.0037628, -0.093643, 0.10094, -0.039462, -0.043404, -0.0015448, -0.012831, -0.074652, 0.004365, 0.014048, 0.0045125, -0.00074554, -0.17399, 0.01385, 0.0031521, -0.011665, -0.0006986, 0.0029414, 0.0096906, -0.0065594, 0.00070166, 0.031185, -0.012213, 0.00010771, 0.0026551, 0.035949, -0.00035913, -0.00094525, 0.018059, -0.0033219, -0.00050513, 0.027967, -0.000053283, 0.017352, -0.00090916, 0.028545, 0.013304, 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 8.5471, 1.0036e-6, -0.21407, 1.1825e-6, -0.30424, 1.5359e-6, 0.13422, -0.016014, 1.8552e-6, 0.067452, -1.4486e-6, -0.03629, 1.3742e-6, 0.14981, 4.855e-8, -0.0024666, 1.4397e-7, -0.024247, 1.2519e-8, -0.033219, -1.2566e-7, 0.0038258, 1.2039e-7, 0.0063462, 0.036086, 3.5782e-7, 0.018118, -3.0822e-8, -0.010032, -0.031399, 3.2563e-7, 0.00075683, -8.9661e-8, 0.010092, -1.6976e-7, 0.0078276, 5.0854e-8, 0.0055042, -1.3474e-7, -0.0026094, 0.00025317, 1.2753e-7, 0.002953, 0.005285, -3.6304e-8, -0.001777, -7.7952e-8, 0.00072939, -0.0050116, 8.1116, -0.59186, -0.13615, -0.18696, 0.095077, 0.09062, 0.23509, -0.14233, -0.02228, 0.072726, -0.017002, 0.013668, -0.016439, -0.1832, -0.029248, -0.087976, -0.051588, 0.027987, -0.020067, -0.066101, -0.012527, 0.016175, -0.0051555, 0.00073867, -0.3287, -0.01942, -0.016805, 0.0025031, 0.0084785, 0.013727, -0.033331, 0.0041629, 0.00036778, 0.014714, -0.0043042, -0.0012047, 0.00025714, 0.026942, -0.012786, 0.00050574, 0.029082, -0.0093908, 0.0050755, 0.015606, -0.0050868, 0.018251, -0.0026124, 0.015416, 0.018188, 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 8.5395, -1.2355e-6, -0.35963, -8.3898e-7, -0.30322, 1.7365e-6, 0.17334, 0.072227, -1.029e-6, 0.10917, 3.3145e-8, -0.020338, -2.8147e-7, 0.019255, -3.5607e-8, -0.047856, -2.999e-7, 0.017713, 8.7537e-8, -0.030223, -2.1642e-7, 0.0049244, -1.5008e-7, 0.0090134, -0.0054076, -1.7635e-7, 0.0026828, 1.8278e-9, -0.0046448, -0.0002065, -1.1633e-7, -0.00023058, -7.8885e-8, 0.0055645, 2.242e-8, 0.0036199, 3.1934e-8, -0.014958, -4.0761e-8, -0.0024953, 0.019343, -2.4736e-8, 0.0048865, 0.00026303, 2.6057e-8, -0.0076145, -3.5056e-8, 0.0044221, -0.011743, 8.0106, -0.44548, -0.18174, -0.14286, 0.023503, 0.15303, 0.30849, -0.13076, 0.06387, 0.085933, -0.027825, -0.019401, -0.011111, -0.15264, -0.11578, -0.1551, -0.035013, 0.028185, -0.0026338, 0.0047758, 0.011463, 0.010401, -0.0066656, -0.001277, -0.27712, -0.022595, -0.017372, 0.0036625, 0.0012089, 0.036612, -0.035766, -0.0047622, 0.00080404, 0.020356, -0.0126, -0.0038058, -0.0030403, 0.021958, -0.0097326, -0.0047118, -0.018127, -0.0065368, 0.0018119, 0.00056672, -0.0070145, -0.000022251, 0.00030327, 0.0052279, 0.0071842, 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 8.5126, 6.6638e-7, -0.43467, 2.6349e-6, -0.21941, 1.2981e-6, 0.078944, -0.02422, -5.7262e-7, 0.099112, -1.2219e-8, 0.038104, 6.1122e-7, -0.13751, 2.0071e-7, -0.053385, 6.6087e-7, 0.038775, 3.6086e-7, -0.062806, -4.5958e-8, -0.005224, 2.7794e-8, -0.010112, -0.020386, -4.1445e-7, -0.047492, -3.1373e-8, -0.010906, 0.03109, -7.2809e-9, -0.0071495, 3.8796e-8, 0.053399, 1.9761e-7, -0.0020636, -9.4328e-8, -0.00051179, -5.4058e-8, -0.012413, 0.02446, -8.3003e-8, -0.0080597, 0.010507, -3.2739e-8, 0.0049636, -1.8945e-8, 0.013645, -0.0071743, 7.8861, -0.2514, -0.024407, -0.20198, -0.025291, 0.11063, 0.13606, -0.050165, 0.1438, 0.12596, -0.025094, -0.0044737, -0.010152, -0.24527, -0.21181, -0.11042, -0.0095258, 0.011105, -0.018623, 0.11621, 0.013438, 0.021396, 0.006353, 0.010809, -0.15715, -0.047383, -0.0010913, -0.01463, -0.0036688, 0.037541, -0.012694, 0.008736, -0.0011349, 0.040484, -0.026862, -0.003473, -0.0072372, -0.003346, -0.0081202, 0.0051497, -0.013913, -0.0032409, 0.0021047, -0.0083477, -0.0081966, 0.0042594, -0.0029227, -0.0092693, 0.0022682, 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.};

    double dhl[4][3][49] = {8.6764, -5.8497e-7, -0.45196, 7.6173e-7, 0.083042, 7.3664e-8, 0.0018834, 0.0092107, -1.1006e-7, -0.0023918, 9.0788e-8, -0.010721, -1.2242e-8, -0.039583, -1.9542e-7, 0.0347, 2.6014e-7, -0.026578, -6.0613e-8, 0.11531, 3.2992e-8, -0.0095224, 1.9769e-8, -0.0007937, -0.065651, -1.386e-8, 0.0079121, 2.2614e-8, -0.0027439, -0.018201, 5.4429e-8, 0.001485, 1.3296e-8, 0.02591, -2.0974e-8, 0.0030923, 9.1638e-9, -0.01621, -1.6375e-8, 0.00070846, 0.020751, 5.2109e-9, -0.00073979, -0.0042, -1.3623e-8, 0.0039613, 2.342e-8, -0.0036036, 0.0037577, 8.7464, 0.13755, -0.49056, -0.04826, 0.16354, 0.068999, 0.085903, 0.1102, -0.017707, 0.012783, 0.0091457, -0.017928, 0.011734, -0.038862, 0.023903, 0.0071281, 0.011954, -0.0022804, -0.0086807, 0.061365, 0.0028978, -0.00096905, -0.00046418, 0.0036991, -0.060207, 0.012697, -0.0041056, -0.0045619, 0.0012074, -0.016589, 0.016563, -0.00021209, 0.002449, 0.029887, 0.0038303, 0.0019922, 0.00020211, -0.020114, 0.0052825, 0.00025115, 0.0022024, 0.0081118, -0.00097042, -0.0077664, 0.006033, 0.00068127, 0.0039275, -0.0038098, 0.0057959, 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 9.3142, -4.9414e-7, -0.64289, -2.0151e-6, -0.078257, -1.3701e-6, -0.12501, 0.065449, -4.8812e-7, 0.014953, 3.4548e-7, -0.033211, -5.4121e-7, 0.0017444, -3.9167e-7, 0.01348, 5.4127e-7, -0.069938, -1.6812e-7, 0.10559, -2.5102e-8, -0.0010793, -1.506e-7, 0.0059427, -0.00079428, 2.9945e-7, 0.011037, 1.2265e-8, 0.0018328, -0.035544, -1.602e-7, -0.00060623, 1.847e-8, 0.0084732, -5.0107e-8, 0.0051421, 1.0662e-8, -0.029206, 4.8502e-8, -0.0026379, 0.01469, 5.0003e-8, 0.00018659, -0.0039958, 2.9606e-8, 0.0069968, 1.104e-8, -0.00059425, 0.0012121, 9.4313, -0.071878, -0.69971, 0.16547, 0.10161, 0.1578, 0.2938, 0.14776, -0.062061, 0.018808, -0.012118, -0.020569, 0.032844, -0.0035689, 0.010216, -0.017151, -0.016616, -0.012647, 0.010205, 0.061252, 0.010258, -0.010887, 0.0031761, -0.0028283, -0.049813, 0.034723, -0.031727, 0.015177, -0.0065093, -0.024869, 0.0030012, -0.001563, 0.00066333, 0.0073866, 0.018974, -0.0016075, 0.0034999, -0.002234, 0.00051294, 0.0023417, 0.011325, 0.0048485, -0.0013997, 0.0071165, 0.0051959, 0.0073597, 0.0043606, 0.010201, 0.006508, 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 9.5154, 4.4387e-7, -0.83777, -1.4337e-7, -0.036703, 1.1904e-6, 0.05785, 0.089301, -1.0837e-7, 0.069043, -2.5006e-7, -0.036223, 3.625e-7, -0.036352, -1.4407e-7, -0.028911, -7.301e-8, -0.047333, 9.3189e-8, 0.064058, -2.5044e-8, 0.015224, 5.7261e-8, 0.010738, 0.014165, -2.475e-7, 0.0098615, -2.6232e-7, 0.0017438, -0.0044838, 1.1605e-7, 0.0015004, 6.3422e-8, 0.020907, -6.8549e-8, 0.0031254, -6.0456e-8, -0.026752, 3.1056e-9, -0.0039871, 0.0029555, -2.4656e-9, 0.0014655, -0.00052332, -1.1751e-7, 0.0016169, 3.9033e-8, -0.0013868, 0.0007044, 9.5243, -0.059807, -0.87275, 0.22117, 0.15301, 0.10504, 0.33841, 0.10576, -0.072307, 0.096274, -0.029255, -0.014589, 0.020619, 0.039283, -0.05855, -0.0092836, -0.047394, -0.017612, 0.040558, 0.072842, -0.013231, 0.0077768, -0.0097764, 0.0020915, -0.01816, -0.019791, -0.0086255, 0.0012757, 0.0018743, -0.0066028, -0.0057812, -0.011538, 0.0046084, 0.0028366, -0.0022018, 0.0049727, -0.0056196, -0.0010703, 0.0068549, -0.00059359, -0.0010457, 0.0027387, -0.0029393, 0.0068835, 0.0043346, 0.0080149, 0.0015508, 0.0088104, 0.0048858, 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 9.5646, 7.095e-7, -0.89711, 1.9288e-6, -0.16734, 4.3813e-6, 0.11898, -0.002068, 7.7446e-7, 0.070217, 3.5016e-7, 0.017233, 5.7925e-7, -0.11643, 2.5154e-7, -0.063259, 5.6847e-7, -0.011006, 5.3229e-8, 0.07952, 3.0792e-7, 0.02325, 1.225e-7, 0.0054205, 0.0060078, 5.5043e-7, -0.011446, 2.6075e-7, -0.0026486, -0.017948, 5.7737e-8, -0.0077932, 7.3237e-9, 0.013457, 1.4871e-7, -0.0018273, 9.6374e-8, -0.014154, 3.4815e-8, -0.0050702, 0.013526, 3.8902e-8, -0.0015015, 0.0025405, 8.9053e-8, 0.0054088, -2.6652e-8, 0.0036377, 0.00035619, 9.422, 0.12025, -0.79687, 0.14928, 0.21997, -0.25538, 0.36075, 0.16937, -0.013366, 0.19409, -0.047118, -0.013312, 0.01916, -0.0044608, -0.13351, 0.027297, -0.044798, -0.012571, 0.033471, 0.064905, -0.02786, 0.040406, -0.011265, 0.013243, 0.00032774, -0.049982, 0.008122, 0.0035041, 0.00079319, 0.0098909, -0.0054041, 0.00070907, 0.00047071, 0.044426, -0.0053094, 0.001042, -0.0013821, -0.02569, 0.0025739, -0.0012, 0.0039956, -0.0033401, 0.0031321, -0.010688, 0.0015289, -0.0048343, 0.00066546, -0.0095524, -0.0029806, 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.};

    double doh[4][3][49] = {11.638, 2.1979e-6, -0.23248, -3.3214e-7, 0.11898, 3.0748e-6, 0.0026115, -0.2456, 1.2462e-7, 0.020023, 1.64e-7, 0.0062374, -6.4331e-8, -0.26353, 3.389e-8, 0.036762, 1.8064e-7, -0.022751, 2.8274e-8, 0.11224, -1.9642e-7, -0.0087787, -6.0584e-9, -0.0046188, 0.010754, 1.0973e-7, 0.0087284, 5.2698e-8, 0.005197, -0.066284, -5.0381e-7, 0.0025389, 1.7134e-7, 0.022995, 4.7651e-7, 0.00048065, -1.5021e-8, 0.0021538, -1.8609e-7, 0.0050122, 0.0032356, 2.176e-8, 0.00099773, -0.0016112, -1.7006e-7, 0.0045044, 8.673e-8, 0.0014997, -0.0042748, 11.466, 0.40119, -0.41736, -0.192, 0.037017, -0.02632, -0.073409, -0.16393, -0.0075744, 0.047543, -0.0059249, -0.0091045, 0.0075707, -0.066604, 0.033164, 0.0088713, 0.0069505, -0.0037147, -0.0094076, -0.04744, 0.00051116, -0.020023, 0.011603, 0.0058822, -0.018973, -0.00032266, -0.010472, 0.0087367, 0.00087078, 0.030624, -0.014384, 0.0011849, 0.0016199, 0.052375, -0.0051855, 0.0050677, 0.00058491, -0.026023, 0.0021862, 0.00017057, 0.0014512, 0.009285, -0.0018361, -0.015087, 0.0016268, -0.0051916, 0.003141, -0.0075738, 0.0020747, 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 10.822, 1.0243e-6, -0.011612, -3.909e-6, 0.17949, 5.2434e-6, -0.055277, -0.4225, 2.2743e-7, -0.01785, -2.1446e-7, 0.020109, 2.5441e-8, -0.28437, 2.8675e-7, 0.046531, -1.747e-7, -0.012887, -7.0467e-8, -0.11997, 2.0672e-7, -0.021904, 3.2349e-8, 0.014037, 0.059543, 4.188e-7, -0.0003279, -9.1809e-8, 0.0088505, -0.010878, -4.1668e-7, -0.016918, 4.187e-8, -0.031914, 2.2837e-7, -0.010269, -3.4403e-8, 0.00066131, -1.4563e-7, -0.0060043, -0.017662, -1.6897e-9, -0.0076391, -0.0030607, -1.5907e-7, -0.0082787, 2.1356e-9, -0.0076774, 0.012753, 10.62, 0.41405, 0.047224, -0.17052, 0.020812, -0.016568, -0.017739, -0.36758, 0.12945, -0.05769, 0.016517, 0.00043426, -0.0084872, -0.17111, -0.043498, 0.09672, 0.0066361, -0.017696, -0.0073752, -0.059474, 0.0706, -0.021261, -0.0045486, -0.0023596, -0.060694, -0.03402, 0.025395, -0.010267, 0.0051524, 0.024349, 0.012764, 0.0047153, 0.0030511, 0.071283, 0.0079275, 0.0091649, -0.0012318, -0.042938, -0.0030165, 0.0029838, -0.016615, 0.0012946, 0.0027673, -0.037213, 0.0006064, -0.027206, 0.0014542, -0.028307, -0.0073467, 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 9.7937, -1.9164e-6, 0.35453, 1.6223e-6, 0.20156, -1.021e-6, -0.11503, -0.82204, 5.7192e-8, -0.048372, 9.9279e-8, 0.060963, 4.403e-8, -0.40169, -1.2124e-6, 0.11542, 7.4444e-7, -0.016794, -7.7795e-8, -0.23478, 1.8889e-6, -0.057216, -8.5613e-8, 0.0022638, -0.18245, -6.7741e-7, 0.00056764, 1.0843e-7, 0.0086873, -0.032154, 1.2769e-6, -0.023455, 2.3495e-8, 0.044324, 5.8249e-7, -0.0097873, -4.9479e-8, -0.043582, 2.44e-7, -0.0047593, 0.01152, 6.1115e-7, -0.0061079, 0.0046842, -7.766e-8, -0.014542, 1.301e-7, 0.00012669, 0.026225, 9.7559, 0.73006, 0.023915, -0.35479, 0.23232, 0.043105, -0.083276, -0.61803, 0.24574, 0.010126, -0.013819, 0.052543, -0.024424, -0.16943, 0.04619, 0.054503, -0.047693, 0.028382, -0.040051, 0.036658, -0.071019, 0.033261, 0.0014489, 0.0025216, -0.0026986, 0.0028257, 0.011303, 0.013446, 0.00064292, 0.070927, -0.048257, 0.01175, 0.00029293, 0.030686, -0.029274, -0.00014456, 0.0022379, -0.016401, -0.011951, -0.000083522, -0.0022854, -0.0051928, -0.0010387, -0.024951, 0.0023471, -0.013592, -0.002213, -0.0078338, 0.00070712, 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 9.1209, -3.506e-8, 0.5622, 7.2825e-7, 0.18242, 1.6496e-6, -0.13481, -0.62102, 1.3313e-6, -0.072196, 2.8528e-7, 0.039029, 5.3745e-8, -0.60644, 3.8846e-7, 0.10864, -2.9182e-7, 0.019555, 1.161e-8, -0.11778, 6.6455e-9, -0.043774, 2.4623e-7, -0.0073456, -0.10794, 2.8097e-7, -0.0061924, 5.5108e-8, 0.0065963, 0.0097996, -1.4108e-7, 0.013135, 3.9136e-9, 0.20612, 1.5759e-7, 0.0029679, 1.915e-7, 0.055943, -9.0442e-9, 0.0087562, 0.071924, -8.2087e-8, 0.0037554, 0.0035717, 7.9697e-8, 0.0076157, -8.0663e-8, -0.0039358, 0.010457, 8.9497, 0.67881, 0.39055, -0.32002, 0.13908, 0.028471, -0.17994, -0.73377, 0.11401, -0.016313, 0.058219, -0.0024831, -0.018989, -0.60576, 0.12761, 0.079504, -0.052144, 0.011163, 0.00066893, -0.034924, 0.016598, -0.0071152, 0.0045419, -0.0025894, -0.17938, -0.0091538, -0.0055001, 0.0083203, 0.0012648, 0.18489, 0.0029295, 0.0078076, -0.0062127, -0.069425, 0.0064065, -0.0031037, 0.0028284, -0.015089, 0.0013666, 0.00221, 0.0036826, 0.0094428, -0.0024497, -0.0101, -0.0041794, -0.024757, 0.000082641, -0.0090907, -0.00578, 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.};

    double dnh[4][3][49] = {10.019, 2.5723e-6, -0.0008496, 8.1102e-7, 0.097779, 1.0615e-6, 0.076222, -0.14428, 3.2342e-7, -0.014089, -3.4285e-7, -0.013037, 7.6984e-8, -0.20229, 8.1544e-7, -0.042526, 1.965e-7, 0.0085229, 2.009e-7, 0.044525, -7.3598e-8, 0.011851, -7.3302e-8, 0.0010225, 0.023862, 2.6317e-8, 0.017643, -6.88e-8, -0.0018743, -0.025839, 2.057e-8, 0.0037364, -7.4188e-8, -0.021742, -9.5189e-8, 0.0057009, -2.2182e-8, 0.0025205, 6.133e-8, 0.0012046, -0.014426, 2.2803e-8, 0.0018722, -0.0022612, -8.6377e-8, -0.0023099, 6.1868e-8, -0.002228, -0.0072127, 9.895, 0.53898, -0.18438, -0.033234, 0.061092, -0.044223, 0.049314, -0.16885, 0.023645, 0.049904, -0.013272, -0.010006, 0.0098171, -0.1277, 0.054348, -0.0094108, -0.016097, 0.0025746, -0.0056109, -0.09598, 0.024506, -0.01932, 0.0044041, 0.00058621, 0.010298, 0.0066383, -0.0036596, 0.0031693, -0.0012114, 0.027192, -0.012499, 0.0022087, 0.000071793, 0.029456, -0.018417, 0.0066479, -0.0010839, -0.032662, 0.0024478, -0.0013406, -0.023848, 0.0039534, -0.0019607, -0.024437, -0.00025257, -0.012976, 0.00057891, -0.013725, 0.00039792, 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 9.4694, -1.6544e-6, 0.12337, 7.6922e-6, 0.040844, -6.2726e-6, -0.012085, -0.31155, -2.2502e-6, 0.0052141, 1.5292e-6, 0.0046169, -3.443e-7, -0.2098, -6.0445e-7, 0.049811, 5.3263e-7, 0.00065131, -1.6033e-7, -0.10316, -1.1576e-6, -0.016319, 1.824e-7, 0.010867, 0.0717, -1.04e-6, 0.001532, 7.316e-7, 0.0057948, -0.07441, -5.4983e-7, -0.011335, -9.1272e-9, -0.042801, -6.1656e-7, -0.010028, 1.2323e-7, -0.0020959, -2.862e-7, -0.0041891, -0.010114, -2.4946e-7, -0.0054484, -0.00010014, -6.1357e-8, 0.0025335, -1.4098e-7, -0.027616, 0.017588, 9.285, 0.55985, 0.22704, -0.070123, -0.11388, -0.094701, 0.028391, -0.19589, 0.068225, -0.053756, 0.014622, 0.00057994, -0.0029261, -0.24712, -0.017103, 0.061, 0.015448, -0.012181, -0.0086816, -0.024797, 0.069824, -0.00043173, -0.0029083, -0.0016011, -0.02184, -0.03501, 0.014547, -0.0092115, 0.0047761, 0.012071, 0.0077499, 0.0081855, 0.0022545, 0.024944, -0.0060505, 0.0078059, 0.0023805, -0.051867, -0.008038, -0.0009783, -0.02922, -0.0019427, 0.0030433, -0.033815, -0.0022415, -0.029646, -0.0034173, -0.029588, -0.0094138, 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 8.7155, 1.4741e-6, 0.33257, -3.9187e-7, 0.0091878, -1.6825e-6, -0.044178, -0.49152, 1.8469e-6, -0.010781, 4.6555e-7, 0.032247, -4.2322e-7, -0.27076, 5.7315e-7, 0.10441, 1.5751e-7, -0.019427, -2.5181e-7, -0.15498, 4.8205e-7, -0.029731, 8.4155e-8, 0.0027337, -0.15423, 4.0527e-7, 0.010853, 1.7637e-7, 0.00029832, -0.032027, 4.2496e-8, -0.010391, 1.6182e-8, 0.020184, 1.178e-7, -0.0036163, 7.9778e-8, -0.037631, 3.5515e-8, -0.0038295, 0.0025399, -4.9073e-9, -0.0028015, 0.00021214, 2.7217e-8, -0.011954, -9.2222e-8, -0.0096978, 0.0065686, 8.6689, 0.77532, 0.16981, -0.16926, -0.016344, -0.049955, -0.030453, -0.24772, 0.1245, 0.013351, 0.00087996, 0.018177, -0.025308, -0.10649, 0.078115, 0.0078976, -0.038263, 0.023854, -0.031419, -0.0013547, -0.071151, 0.026453, -0.00068153, 0.0010626, 0.02174, 0.031895, 0.0012209, 0.0064036, 0.002833, 0.0054547, -0.0261, 0.006799, -0.0011911, -0.0078806, -0.015986, -0.0066544, 0.0022161, -0.016487, -0.0089076, 0.0004513, -0.011831, -0.01107, -0.0022416, -0.014739, -0.0038693, -0.011053, -0.0015497, -0.013144, -0.0067004, 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 8.2446, -3.9022e-6, 0.42086, -8.4724e-8, -0.045965, 5.3823e-7, -0.01322, -0.22697, -5.8269e-7, -0.014812, -2.988e-7, -0.0039232, 1.729e-8, -0.46253, -9.6196e-8, 0.062313, 4.2635e-7, 0.017812, 1.2969e-7, -0.064979, 1.4935e-7, -0.035472, 6.1687e-8, -0.0077464, -0.044305, -3.3255e-7, -0.0021269, -2.9698e-7, 0.0042903, 0.010216, 2.095e-8, 0.0033693, 1.5003e-8, 0.1403, 9.8769e-8, -0.0043899, -6.7915e-8, 0.069364, 4.3913e-8, 0.0036741, 0.026018, 8.9366e-8, 0.00039212, 0.0086551, 6.6664e-8, 0.0091264, 1.4846e-8, -0.0011903, 0.000068326, 8.1232, 0.634, 0.34451, -0.17706, -0.096395, -0.033631, -0.038348, -0.37099, 0.043368, -0.022563, 0.041095, -0.022098, 0.0037783, -0.38367, 0.11212, 0.0399, -0.034603, 0.00090102, 0.00017867, -0.049073, 0.0057379, -0.016769, 0.0094616, -0.0048618, -0.20081, 0.0072646, -0.0091609, 0.008109, -0.00058271, 0.1365, -0.0024914, -0.001228, -0.00043112, -0.09052, 0.022466, -0.0079454, 0.0027647, 0.0083267, -0.0063168, 0.0022216, -0.0086691, 0.0025916, -0.0019514, -0.0049024, -0.0036766, -0.023492, -0.00079399, 0.0037814, -0.016833, 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.};

    double dheh[4][3][49] = {8.5562, -6.7753e-8, -0.59333, 1.0384e-6, -0.28833, -8.8932e-7, 0.13836, 0.20484, 1.3434e-8, -0.057765, -4.4369e-8, 0.027521, -8.8706e-8, 0.39828, 9.9476e-8, -0.019442, 3.6408e-7, -0.026872, -3.1503e-7, -0.19197, -4.7243e-8, 0.0008864, -1.3824e-8, -0.01347, -0.27662, 1.272e-7, -0.0096029, 4.5527e-8, 0.0010784, -0.098919, -3.6199e-9, -0.007878, 1.1979e-8, -0.063545, 5.1229e-9, 0.02134, 6.9696e-8, -0.0020368, 1.9672e-8, 0.0013091, 0.014277, 8.11e-8, 0.0015916, -0.0061413, 4.4252e-9, 0.0052119, 4.2404e-8, -0.015831, 0.0087771, 8.4548, -0.46108, -0.2857, 0.31867, -0.0013751, -0.22585, 0.027861, 0.053882, 0.24531, -0.016614, -0.021614, 0.00052188, -0.00071877, 0.10749, 0.0079494, -0.057983, -0.035115, 0.0021946, 0.0044208, -0.12911, 0.06045, 0.017482, 0.0055533, -0.0040699, -0.23475, 0.062598, -0.025732, -0.0060082, 0.00040616, -0.035725, -0.0070466, 0.0032939, -0.0040902, -0.015459, 0.0024557, -0.0016614, -0.00086784, 0.029412, -0.00073953, -0.0032179, -0.0046908, -0.0014583, 0.00090449, -0.007525, -0.0010508, 0.001846, -0.0013508, -0.0068072, -0.0013448, 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 9.2145, 1.6979e-7, -0.91857, 2.0716e-6, -0.23914, -3.5727e-6, 0.31041, -0.047453, 1.0117e-6, 0.06557, 3.0985e-7, -0.066558, -4.5164e-7, 0.077242, 2.8717e-7, -0.089984, 5.2001e-8, -0.045497, -1.4626e-7, -0.10729, -3.836e-8, 0.016964, 8.6957e-8, 0.00018799, -0.018424, -1.4543e-7, 0.033958, 1.0099e-7, -0.0026298, -0.16571, 6.3739e-8, -0.0017494, 1.6987e-7, 0.051204, 2.65e-7, 0.0050013, 3.6144e-8, 0.0087354, -3.7456e-8, 0.0028601, -0.0017103, -7.148e-9, -0.0025359, -0.0030116, 5.7501e-8, 0.0056945, 6.9904e-8, -0.019349, -0.012641, 8.7717, -0.48916, -0.53663, 0.20667, -0.11371, 0.0026697, 0.014339, -0.27105, 0.036089, 0.016995, 0.030412, -0.053812, -0.0056648, -0.045882, -0.012868, -0.018613, -0.0096389, -0.0050658, -0.005567, 0.0067055, -0.010661, -0.0080307, -0.0046221, 0.0083254, -0.12762, 0.025276, -0.024689, 0.012249, -0.010867, 0.025041, 0.018546, 0.010281, -0.0025269, -0.055967, 0.014229, 0.010142, 0.0021503, 0.035215, 0.0058207, -0.00042017, 0.0027797, -0.0014003, 0.0015366, 0.014103, 0.0061949, 0.010431, 0.0017503, 0.016873, 0.010208, 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 9.1382, -1.6957e-6, -1.0442, 1.2347e-6, -0.34358, 6.823e-7, 0.44436, 0.016324, -4.3446e-7, -0.02314, -1.8743e-7, -0.038261, 1.6702e-7, -0.031722, -5.1618e-7, 0.046237, -1.1968e-7, -0.017095, 2.3684e-7, -0.10912, 8.5906e-8, -0.007578, -5.7318e-8, 0.0034197, -0.16487, -5.7436e-7, 0.034923, -4.8531e-10, -0.012999, -0.057078, 3.2258e-8, -0.0041749, 4.3545e-8, -0.043926, 8.9899e-9, 0.0090836, -1.0023e-8, 0.026406, -4.346e-8, 0.00097611, -0.045719, 9.536e-8, 0.0032015, -0.0030497, -4.9917e-8, -0.0052358, 1.5254e-8, -0.020919, -0.0046316, 8.6956, -0.37513, -0.76166, 0.058258, -0.44109, 0.11952, 0.44731, 0.061168, -0.050179, 0.0052661, -0.010086, -0.011434, 0.024774, 0.034482, -0.13156, 0.030048, -0.061629, -0.0080153, -0.0034766, 0.017056, -0.025625, 0.016715, 0.0067878, -0.0021396, -0.049347, 0.015841, 0.0017152, 0.0007241, 0.0016179, -0.030269, 0.016246, 0.0014672, 0.0021578, -0.025516, 0.012958, -0.0065452, 0.003327, -0.0016907, 0.0074365, -0.0011628, 0.010449, -0.0012092, 0.0025582, 0.0071529, 0.0011959, 0.0098574, 0.0016045, 0.0032251, 0.0072336, 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 8.8817, -2.4391e-6, -1.3655, 8.4386e-7, -0.22789, 8.7854e-7, 0.43537, 0.018615, -7.1575e-7, 0.013645, -4.9988e-7, -0.032013, 3.6249e-7, -0.014024, -4.6747e-7, 0.043299, -2.0939e-7, -0.019031, 5.364e-7, -0.057979, -1.1916e-7, -0.0097389, -7.0552e-8, -0.0038403, -0.018747, -4.5508e-7, 0.00058662, -1.4839e-7, -0.0023248, 0.035164, -3.853e-8, 0.0014493, 9.0911e-9, 0.065064, -7.7367e-8, -0.0076839, -4.4329e-8, 0.026307, 6.0727e-8, 0.0026258, -0.0080157, -8.9614e-9, 0.00057615, -0.0013741, 1.9524e-8, 0.0032822, -5.1476e-9, -0.0013574, 0.0017923, 8.5683, -0.14807, -0.81147, -0.018822, -0.45791, 0.068315, 0.41478, -0.03785, 0.12571, 0.012702, 0.007426, -0.031216, 0.013414, -0.099827, 0.04722, -0.002388, -0.0066048, -0.0066849, -0.014619, -0.011156, 0.0036579, 0.0041293, 0.014703, 0.0039578, -0.057658, 0.0030119, -0.01073, 0.0034455, -0.0059462, -0.018327, -0.010196, -0.0051724, 0.002024, -0.028124, 0.010821, -0.0047065, 0.0034806, -0.014711, 0.0042184, -0.0020076, 0.0091568, -0.0027745, 0.0009307, -0.001101, -0.00029865, -0.0010161, 0.0010107, 0.00079248, 0.00438, 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.};

    double dhh[4][3][49] = {8.4599, -9.9884e-7, -0.35443, -6.581e-7, -0.029651, 5.2904e-7, 0.0093573, 0.45701, 1.9996e-7, -0.024248, 7.7567e-8, 0.011724, -2.3639e-8, 0.0042217, -1.123e-7, 0.023361, 1.2442e-7, -0.0075842, 2.914e-8, 0.050338, -5.2187e-8, 0.0070107, -6.2618e-8, -0.0011794, -0.12422, -7.0145e-8, -0.0060802, -1.7967e-8, -0.0035129, -0.058675, 1.8341e-8, 0.0012289, -1.1887e-8, 0.11607, 2.2739e-8, 0.014341, -8.2486e-9, -0.032079, -4.4285e-8, 0.002181, 0.040119, 3.4542e-9, 0.0014022, -0.0094002, 2.07e-8, 0.006921, 1.3041e-8, -0.00033684, 0.0088583, 8.7052, -0.010386, -0.39422, 0.022079, 0.10061, -0.10053, -0.038012, 0.40303, 0.1145, -0.036893, 0.0071546, 0.0048412, -0.0031532, 0.053452, -0.071005, 0.011385, 0.0002083, -0.0034358, -0.00099962, 0.10466, 0.026587, -0.00050469, 0.010174, -0.00031445, -0.14247, 0.010854, -0.0083255, -0.01045, 0.003393, -0.041298, 0.0083111, 0.0024336, -0.0023697, -0.021893, 0.015365, 0.0030954, -0.0055201, -0.011731, 0.011634, -0.0014933, 0.00052614, 0.0078891, -0.001012, -0.0086891, 0.0082004, 0.0062137, 0.0042136, -0.01312, 0.0092474, 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 9.387, -1.3719e-7, -0.83508, -5.9282e-7, 0.061012, -5.2218e-7, 0.19141, 0.41174, 3.8016e-7, -0.025064, -9.7075e-8, -0.033704, -3.083e-8, 0.06398, 5.1005e-7, -0.022929, 3.6584e-7, -0.0012908, -4.1545e-8, 0.0234, -3.5827e-8, 0.01685, 1.4133e-7, 0.0045264, -0.16435, 1.7264e-7, 0.0042052, 1.6665e-7, 0.0057113, 0.026847, 2.015e-7, 0.0007116, 2.694e-8, 0.059238, 3.4505e-8, 0.0023152, -1.4563e-10, -0.030566, 9.2142e-9, 0.00033032, -0.020039, 1.0352e-8, 0.0019382, -0.00055282, -6.9643e-8, -0.0042814, 8.0598e-8, 0.011031, -0.026108, 9.4299, -0.051759, -0.81008, 0.13248, 0.14374, 0.028595, -0.0036756, 0.24542, 0.084647, 0.026415, 0.033343, -0.015748, -0.0079269, 0.080631, 0.010277, -0.018242, -0.023267, -0.0010559, 0.0082585, 0.021509, -0.0081102, 0.0039426, -0.0010183, 0.0068868, -0.051945, 0.018767, 0.0070042, 0.0030618, -0.0013121, -0.068901, 0.023944, 0.0045513, -0.0050356, -0.00016834, 0.0034679, 0.0051671, -0.00050158, 0.0083745, 0.01108, 0.0026952, 0.015059, 0.0041633, 0.0019192, -0.0021979, 0.010921, -0.0021533, 0.0065616, 0.00038826, 0.00011183, 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 9.5205, -2.0222e-6, -1.1864, 7.5985e-7, -0.026909, -4.4005e-7, 0.30973, 0.13675, -4.8308e-7, -0.022609, -3.7822e-7, -0.035004, 4.5696e-8, 0.061285, 2.5084e-7, -0.012329, -4.2144e-8, -0.008354, -2.0386e-7, 0.049594, -2.5843e-7, -0.013798, -1.6222e-7, -0.011448, -0.043079, -2.8827e-7, 0.0077978, -2.7406e-8, 0.0017355, -0.030989, -1.1889e-7, -0.012109, -1.3616e-8, 0.014991, 3.3699e-8, -0.000074128, -5.9458e-9, 0.0071308, 6.3098e-8, 0.0010935, -0.023455, -1.2795e-7, 0.0015102, -0.0013092, 3.8446e-8, -0.00038817, 5.9744e-8, -0.0037063, -0.0086531, 9.4197, -0.014545, -1.3593, 0.33999, -0.19479, 0.04785, 0.37597, 0.15466, -0.055988, 0.059355, -0.042765, -0.025813, 0.031549, 0.030235, -0.031327, 0.070621, -0.03592, 0.0086809, 0.021371, -0.015567, -0.02081, 0.036965, -0.011192, 0.0048831, -0.0011065, 0.014821, 0.0010736, 0.0034666, -0.0024916, -0.013773, 0.0079809, -0.0036052, 0.0043504, -0.03611, 0.0082627, -0.0047435, 0.0073676, 0.021851, 0.010228, -0.002651, -0.0023925, 0.000011321, 0.0021796, 0.0096299, 0.0055079, 0.0059111, 0.0041776, 0.0021261, 0.0024663, 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 9.3714, -3.42e-6, -1.6846, -8.1017e-8, -0.017081, 3.8242e-6, 0.45205, 0.043324, -1.2896e-7, 0.0010528, -1.8358e-7, -0.041534, -1.3077e-7, 0.15865, -5.4277e-7, 0.039447, -3.1248e-7, -0.0067779, 2.9556e-7, -0.0079049, 1.2398e-7, -0.0050936, 6.8695e-8, -0.0049243, -0.03988, -1.048e-7, -0.024017, -5.0755e-8, -0.0031475, 0.013985, -1.2591e-8, -0.0011025, -9.3741e-9, -0.029468, -1.2756e-8, -0.0077319, -1.9948e-8, 0.0017882, -3.5214e-9, 0.00094125, -0.0044217, -6.8571e-9, 0.0015396, -0.00037219, 2.5287e-9, 0.00063584, 8.8245e-9, -0.0010107, -0.0054499, 9.2865, -0.031689, -1.6086, 0.1114, -0.17424, 0.12264, 0.39063, -0.040969, 0.064995, -0.03089, 0.026063, -0.04602, 0.010435, 0.040526, 0.0024349, -0.0073789, 0.032772, -0.0050331, -0.017989, 0.013328, -0.010732, -0.015973, 0.0057027, -0.0053769, -0.060208, 0.033963, -0.012802, 0.0066097, -0.0025335, -0.040039, -0.005703, -0.0089255, -0.001296, -0.0095029, 0.026328, -0.0054759, 0.0018651, -0.0089029, 0.0073539, -0.0012681, 0.0022857, -0.0047377, -0.00089554, 0.0013359, 0.001363, 0.0037962, 0.0029694, -0.0040318, 0.0045768, 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.};

    /* Local variables */
    int il;
    double nhh, nhl, nnh, noh, nnl, nol, nheh, nhel, ntot, nhcorr, nocorr;

    double invdiplat = invariantDipLatitude(diplatitude, invlatitude);

    nol = ionlow(invdiplat, mlt, alt, ddd, dol, 0);
    nhl = ionlow(invdiplat, mlt, alt, ddd, dhl, 1);
    nhel = ionlow(invdiplat, mlt, alt, ddd, dhel, 2);
    nnl = ionlow(invdiplat, mlt, alt, ddd, dnl, 3);
    noh = ionhigh(invdiplat, mlt, alt, ddd, doh, 0);
    nhh = ionhigh(invdiplat, mlt, alt, ddd, dhh, 1);
    nheh = ionhigh(invdiplat, mlt, alt, ddd, dheh, 2);
    nnh = ionhigh(invdiplat, mlt, alt, ddd, dnh, 3);

/*     interpolation (in logarithm) */
    if (pf107obs > 260.) {
		pf107obs = 260.;
    }
    if (pf107obs < 65.) {
		pf107obs = 65.;
    }
    no = (log10(noh) - log10(nol)) / 125. * (pf107obs - 85.) + log10(nol);
    nh = (log10(nhh) - log10(nhl)) / 125. * (pf107obs - 85.) + log10(nhl);
    nhe = (log10(nheh) - log10(nhel)) / 125. * (pf107obs - 85.) + log10(nhel);
    nn = (log10(nnh) - log10(nnl)) / 125. * (pf107obs - 85.) + log10(nnl);
/*     percentages */
    no = pow(10., no);
    nh = pow(10., nh);
    nhe = pow(10., nhe);
    nn = pow(10., nn);
/*     normalization */
    ntot = no + nh + nhe + nn;
    no /= ntot;
    nh /= ntot;
    nhe /= ntot;
    nn /= ntot;
/*     C/NOFS correction */
    if (pf107obs <= 67.5) {
		nocorr = corro[0];
		nhcorr = corrh[0];
    }
    if (pf107obs > 67.5 && pf107obs < 87.5) {
		il = (int) ((pf107obs - 57.5) / 10.);
		nocorr = (corro[il] - corro[il - 1]) / 10. * (pf107obs - 57.5 - il * 10) + corro[il - 1];
		nhcorr = (corrh[il] - corrh[il - 1]) / 10. * (pf107obs - 57.5 - il * 10) + corrh[il - 1];
    }
    if (pf107obs < 87.5) {
		no /= nocorr;
		nh /= nhcorr;
		nhe /= nhcorr;
		nn /= nocorr;

		// Normalize
		ntot = no + nh + nhe + nn;
		no /= ntot;
		nh /= ntot;
		nhe /= ntot;
		nn /= ntot;
    }

	ionRelativeDensities[0] = no * 100.0;
	ionRelativeDensities[1] = nn * 100.0;
	ionRelativeDensities[2] = nhe * 100.0;
	ionRelativeDensities[3] = nh * 100.0;

	return;
}

double invariantDipLatitude(double dipLatitude, double invLatitude)
{
    double invLat = fabs(invLatitude); // Matches fortran code, which calculates invlat as positive quantity
    double sign = dipLatitude >= 0 ? 1.0 : -1.0;
    double alpha = 2. - 1./(exp((dipLatitude - 25.0)/2.) + 1.0) - 1./(exp((-dipLatitude - 25.0)/2.) + 1.0);
    double beta = -1. + 1./(exp((invLat - 25.0)/2.) + 1.0) + 1./(exp((-invLat - 25.0)/2.) + 1.0);

    double invdip = (alpha * sign * invLat + beta * dipLatitude) / (alpha + beta);

    return invdip;
}


double ionlow(double invdiplat, double mlt, double alt, int ddd,
	 double d[4][3][49], int ion)
{
    int mirreq[49] = { 1,-1,1,-1,1,-1,1,1,-1,1,-1,1,-1,1,-1,1,-1,1,
	    -1,1,-1,1,-1,1,1,-1,1,-1,1,1,-1,1,-1,1,-1,1,-1,1,-1,1,1,-1,1,1,-1,
	    1,-1,1,1 };

    double c__[49];
    double c1[82];
    double aa, bb, ah[4], st[3], n400, n550, n750, st1, st2, n1000, ano[4], dno[2], sum, n100a, n100b, n400a, n400b, n550a, n550b, n750a, n750b;
    int ddda, dddb, dddd;
    double n0a100, n0b100, n0a400, n0b400, n0a550, n0b550, n0a750, n0b750;
    int seza, sezb;
    double rmlt;
    int sezai, sezbi;
    double rcolat;

	double nion = 0.0;

/* --------------------------------------------------------------------------- */
/* IONLOW calculates absolute density of O+, H+, He+ or N+  in the outer */
/* ionosphere for a low solar activity (F107 < 100). */
/* Based on spherical harmonics approximation of relative ion density */
/* (by AE-C, and AE-E) at altitudes centred on 400km, 550km, 750km, and 1000km. */
/* For intermediate altitudes an interpolation is used. */
/* Recommended altitude range: 350-2500 km!!! */
/* For days between seasons centred at (21.3. = 79; 21.6. = 171; */
/* 23.9. 265; 21.12. = 354) relative ion density is linearly interpolated. */
/* c Inputs: invdiplat - "mix" coordinate of the dip latitude and of */
/*                    the invariant latitude; */
/*                    positive northward, in deg, range <-90.0;90.0> */
/*         MLT - magnetic local time (central dipole) */
/*               in hours, range <0;24) */
/*         ALT - altitude above the Earth's surface; */
/*               in km, range <350;2000> */
/*         DDD - day of year; range <0;365> */
/*         D - coefficints of spherical harmonics for a given ion */
/*         ION - ion species (0...O+, 1...H+, 2...He+, 3...N+) */
/* Output: NION - absolute density for given ion */
/* --------------------------------------------------------------------------- */

	double dtor = M_PI / 180.0;


    /* Function Body */
	/*     coefficients for mirroring */
	for (int i = 0; i < 49; i++)
	{
		d[0][2][i] = d[0][1][i]*mirreq[i];
		d[1][2][i] = d[1][1][i]*mirreq[i];
		d[2][2][i] = d[2][1][i]*mirreq[i];
		d[3][2][i] = d[3][1][i]*mirreq[i];
	}

    rmlt = mlt * dtor * 15.;
    rcolat = (90. - invdiplat) * dtor;

    spharm_ik(c1, 6, 6, rcolat, rmlt);
	for (int i = 0; i < 49; i++)
	{
		c__[i] = c1[i];
	}
    
/*     21.3. - 20.6. */
    if (ddd >= 79 && ddd < 171) {
		seza = 1;
		sezb = 2;
		ddda = 79;
		dddb = 171;
		dddd = ddd;
    }
/*     21.6. - 22.9. */
    if (ddd >= 171 && ddd < 265) {
		seza = 2;
		sezb = 4;
		ddda = 171;
		dddb = 265;
		dddd = ddd;
    }
/*     23.9. - 20.12. */
    if (ddd >= 265 && ddd < 354) {
		seza = 4;
		sezb = 3;
		ddda = 265;
		dddb = 354;
		dddd = ddd;
    }
/*     21.12. - 20.3. */
    if (ddd >= 354 || ddd < 79) {
		seza = 3;
		sezb = 1;
		ddda = 354;
		dddb = 444;
		dddd = ddd;
		if (ddd >= 354) {
			dddd = ddd;
		} else {
			dddd = ddd + 365;
		}
    }
    sezai = (seza - 1) % 3 + 1;
    sezbi = (sezb - 1) % 3 + 1;
/*     400km level */
    n0a400 = 0.;
    n0b400 = 0.;
    for (int i = 0; i < 49; i++) {
		n0a400 += c__[i] * d[0][sezai-1][i];
		n0b400 += c__[i] * d[0][sezbi-1][i];
    }
    n400a = n0a400;
    n400b = n0b400;
    n400 = (n400b - n400a) / (dddb - ddda) * (dddd - ddda) + n400a;
/*     550km level */
    n0a550 = 0.;
    n0b550 = 0.;
    for (int i = 0; i < 49; i++) {
		n0a550 += c__[i] * d[1][sezai-1][i];
		n0b550 += c__[i] * d[1][sezbi-1][i];
    }
    n550a = n0a550;
    n550b = n0b550;
    n550 = (n550b - n550a) / (dddb - ddda) * (dddd - ddda) + n550a;
/*     750km level */
    n0a750 = 0.;
    n0b750 = 0.;
    for (int i = 0; i < 49; i++) {
		n0a750 += c__[i] * d[2][sezai-1][i];
		n0b750 += c__[i] * d[2][sezbi-1][i];
    }
    n750a = n0a750;
    n750b = n0b750;
    n750 = (n750b - n750a) / (dddb - ddda) * (dddd - ddda) + n750a;
/*     1000km level */
    n0a100 = 0.;
    n0b100 = 0.;
    for (int i = 0; i < 49; i++) {
		n0a100 += c__[i] * d[3][sezai-1][i];
		n0b100 += c__[i] * d[3][sezbi-1][i];
    }
    n100a = n0a100;
    n100b = n0b100;
    n1000 = (n100b - n100a) / (dddb - ddda) * (dddd - ddda) + n100a;
	/*     n(O+) AND n(N+) must not increase above 750km */
    if ((ion == 0 || ion == 3) && n1000 > n750) {
		n1000 = n750;
    }
	/*     n(H+) and n(He+) must not decrease above 750km */
    if ((ion == 1 || ion == 2) && n1000 < n750) {
		n1000 = n750;
    }
    if (alt >= 960.) {
		sum = (n1000 - n750) / 220. * (alt - 740.) + n750;
    }
    if (alt >= 960.) {
		nion = pow(10., sum);
		return nion;
    }
    ano[0] = n400;
    ano[1] = n550;
    ano[2] = n750;
    ano[3] = n1000;
    ah[0] = 390.;
    ah[1] = 550.;
    ah[2] = 740.;
    ah[3] = 960.;
    dno[0] = 20.;
    dno[1] = 20.;
    st1 = (ano[1] - ano[0]) / (ah[1] - ah[0]);
    for (int i = 1; i < 3; i++)
	{
		st2 = (ano[i+1] - ano[i]) / (ah[i+1] - ah[i]);
		ano[i] -= (st2 - st1) * dno[i - 1] * log(2.);
		st1 = st2;
    }
    for (int i = 0; i < 3; i++)
	{
		st[i] = (ano[i+1] - ano[i]) / (ah[i+1] - ah[i]);
    }

    sum = ano[0] + st[0] * (alt - ah[0]);

    for (int i = 0; i < 2; i++) {
		aa = eptr(alt, dno[i], ah[i+1]);
		bb = eptr(ah[0], dno[i], ah[i+1]);
		sum += (st[i+1] - st[i]) * (aa - bb) * dno[i];
    }
    nion = pow(10., sum);
    return nion;
} 



double ionhigh(double invdiplat, double mlt, double alt, int ddd, double d[4][3][49], int ion)
{

  	double dtor = M_PI / 180.0;

    int mirreq[49] = { 1,-1,1,-1,1,-1,1,1,-1,1,-1,1,-1,1,-1,1,-1,1,
	    -1,1,-1,1,-1,1,1,-1,1,-1,1,1,-1,1,-1,1,-1,1,-1,1,-1,1,1,-1,1,1,-1,
	    1,-1,1,1 };

    double c__[49];
    double c1[82];
    double aa, bb, ah[4], st[3], n900, n550, st1, st2, n1500, n2500, ano[4], dno[2], sum, n150a, n150b, n250a, n900a, n550a, n550b, n900b, n250b;
    int ddda, dddb, dddd;
    double n0a150, n0b150, n0a250, n0a900, n0a550, n0b550, n0b900, n0b250;
    int seza, sezb;
    double rmlt;
    int sezai, sezbi;
    double rcolat;

	double nion = 0.0;

/* --------------------------------------------------------------------------- */
/* IONHIGH calculates absolute density of O+, H+, He+ or N+  in the outer */
/* ionosphere for high solar activity conditions (PF10.7 = 210). */
/* Based on spherical harmonics approximation of relative ion density */
/* (by IK24) at altitudes centred on 550km, 900km, 1500km, and 2250km. */
/* For intermediate altitudes a interpolation is used. */
/* Recommended altitude range: 500-2500 km!!! */
/* For days between seasons centred at (21.3. = 79; 21.6. = 171; */
/* 23.9. 265; 21.12. = 354) relative ion density is linearly interpolated. */
/* c Inputs: invdiplat - "mix" coordinate of the dip latitude and of */
/*                    the invariant latitude; */
/*                    positive northward, in deg, range <-90.0;90.0> */
/*         MLT - magnetic local time (central dipole) */
/*               in hours, range <0;24) */
/*         ALT - altitude above the Earth's surface; */
/*               in km, range <500;3000> */
/*         DDD - day of year; range <0;365> */
/*         D - coefficints of spherical harmonics for a given ion */
/*         ION - ion species (0...O+, 1...H+, 2...He+, 3...N+) */
/* Output: NION - absolute density for given ion */
/* --------------------------------------------------------------------------- */

/*     coefficients for mirroring */
	for (int i = 0; i < 49; i++)
	{
		d[0][2][i] = d[0][1][i]*mirreq[i];
		d[1][2][i] = d[1][1][i]*mirreq[i];
		d[2][2][i] = d[2][1][i]*mirreq[i];
		d[3][2][i] = d[3][1][i]*mirreq[i];
	}

    rmlt = mlt * dtor * 15.;
    rcolat = (90. - invdiplat) * dtor;
    spharm_ik(c1, 6, 6, rcolat, rmlt);
    for (int i = 0; i < 49; i++) {
		c__[i] = c1[i];
    }
/*     21.3. - 20.6. */
    if (ddd >= 79 && ddd < 171) {
		seza = 1;
		sezb = 2;
		ddda = 79;
		dddb = 171;
		dddd = ddd;
    }
/*     21.6. - 22.9. */
    if (ddd >= 171 && ddd < 265) {
		seza = 2;
		sezb = 4;
		ddda = 171;
		dddb = 265;
		dddd = ddd;
    }
/*     23.9. - 20.12. */
    if (ddd >= 265 && ddd < 354) {
		seza = 4;
		sezb = 3;
		ddda = 265;
		dddb = 354;
		dddd = ddd;
    }
/*     21.12. - 20.3. */
    if (ddd >= 354 || ddd < 79) {
		seza = 3;
		sezb = 1;
		ddda = 354;
		dddb = 444;
		dddd = ddd;
	if (ddd >= 354) {
	    dddd = ddd;
	} else {
	    dddd = ddd + 365;
	}
    }
    sezai = (seza - 1) % 3 + 1;
    sezbi = (sezb - 1) % 3 + 1;
/*     550km level */
    n0a550 = 0.;
    n0b550 = 0.;
    for (int i = 0; i < 49; i++) {
		n0a550 += c__[i] * d[0][sezai-1][i];
		n0b550 += c__[i] * d[0][sezbi-1][i];
    }
    n550a = n0a550;
    n550b = n0b550;
    n550 = (n550b - n550a) / (dddb - ddda) * (dddd - ddda) + n550a;
/*     900km level */
    n0a900 = 0.;
    n0b900 = 0.;
    for (int i = 0; i < 49; i++) {
		n0a900 += c__[i] * d[1][sezai-1][i];
		n0b900 += c__[i] * d[1][sezbi-1][i];
    }
    n900a = n0a900;
    n900b = n0b900;
    n900 = (n900b - n900a) / (dddb - ddda) * (dddd - ddda) + n900a;
/*     1500km level */
    n0a150 = 0.;
    n0b150 = 0.;
    for (int i = 0; i < 49; i++) {
		n0a150 += c__[i] * d[2][sezai-1][i];
		n0b150 += c__[i] * d[2][sezbi-1][i];
    }
    n150a = n0a150;
    n150b = n0b150;
    n1500 = (n150b - n150a) / (dddb - ddda) * (dddd - ddda) + n150a;
/*     2500km level */
    n0a250 = 0.;
    n0b250 = 0.;
    for (int i = 0; i < 49; i++) {
		n0a250 += c__[i] * d[3][sezai-1][i];
		n0b250 += c__[i] * d[3][sezbi-1][i];
    }
    n250a = n0a250;
    n250b = n0b250;
    n2500 = (n250b - n250a) / (dddb - ddda) * (dddd - ddda) + n250a;
/*     O+ and N+ may not increase above 1500km */
    if ((ion == 0 || ion == 3) && n2500 > n1500) {
		n2500 = n1500;
    }
/*     H+ and He+ may not decrease above 1500km */
    if ((ion == 1 || ion == 2) && n2500 < n1500) {
		n2500 = n1500;
    }
    if (alt >= 2250.) {
		sum = (n2500 - n1500) / 750. * (alt - 2250.) + n2500;
    }
    if (alt >= 2250.) {
		nion = pow(10., sum);
		return nion;
    }
    ano[0] = n550;
    ano[1] = n900;
    ano[2] = n1500;
    ano[3] = n2500;
    ah[0] = 550.;
    ah[1] = 900.;
    ah[2] = 1500.;
    ah[3] = 2250.;
    dno[0] = 20.;
    dno[1] = 20.;
    st1 = (ano[1] - ano[0]) / (ah[1] - ah[0]);
    for (int i = 1; i < 3; i++)
	{
		st2 = (ano[i+1] - ano[i]) / (ah[i+1] - ah[i]);
		ano[i] -= (st2 - st1) * dno[i - 1] * log(2.);
		st1 = st2;
    }
    for (int i = 0; i < 3; i++)
	{
		st[i] = (ano[i+1] - ano[i]) / (ah[i+1] - ah[i]);
    }

    sum = ano[0] + st[0] * (alt - ah[0]);

    for (int i = 0; i < 2; i++) {
		aa = eptr(alt, dno[i], ah[i+1]);
		bb = eptr(ah[0], dno[i], ah[i+1]);
		sum += (st[i+1] - st[i]) * (aa - bb) * dno[i];
    }

    nion = pow(10., sum);
    return nion;
}
